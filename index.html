<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç£å¥½é³¥ - Taiwan Good Bird</title>
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: "Microsoft JhengHei", sans-serif; overflow: hidden; background: #f0f2f5;}
        .container { display: flex; height: 100vh; position: relative; width: 100vw; }
        
        /* === å·¦å´æ¬„ä½ (åˆ—è¡¨èˆ‡è³‡è¨Š) === */
        .sidebar-left { 
            width: 340px; background: white; display: flex; flex-direction: column; 
            border-right: 1px solid #ddd; z-index: 20; box-shadow: 2px 0 10px rgba(0,0,0,0.1); 
            height: 100%; flex-shrink: 0; position: relative; 
        }
        
        /* åœ°åœ–å®¹å™¨ */
        #map { flex-grow: 1; height: 100%; z-index: 1; }
        
        /* === å³å´æ¬„ä½ (é³¥ç¨®æœå°‹ç¶²æ ¼) === */
        .sidebar-right { 
            width: 300px; background: #fff; border-left: 1px solid #ddd; 
            display: flex; flex-direction: column; z-index: 20; height: 100%; flex-shrink: 0;
        }

        /* é ‚éƒ¨æ¨™é¡Œèˆ‡ Tab */
        .header { padding: 15px; background: #2c3e50; color: white; text-align: center; font-weight: bold; font-size: 1.2rem; }
        .tabs { display: flex; background: #ecf0f1; border-bottom: 1px solid #ddd; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; color: #7f8c8d; font-weight: bold; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab.active { color: #2c3e50; border-bottom: 3px solid #2c3e50; background: #fff; }

        /* åˆ—è¡¨å®¹å™¨ */
        .list-container { flex: 1; overflow-y: auto; padding: 10px; scroll-behavior: smooth; }
        
        /* åœ°é»å¡ç‰‡æ¨£å¼ (å·²å„ªåŒ–é¡¯ç¤ºç­†æ•¸) */
        .loc-card { 
            background: white; border-radius: 8px; padding: 12px; margin-bottom: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border-left: 4px solid #3498db; 
            transition: transform 0.2s;
        }
        .loc-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .loc-name { font-weight: bold; font-size: 1rem; color: #2c3e50; margin-bottom: 5px; }
        .loc-meta { font-size: 0.85rem; color: #7f8c8d; display: flex; justify-content: space-between; align-items: center; }
        .count-badge { background: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: bold; }
        
        /* è¼‰å…¥æ›´å¤šåµæ¸¬é» */
        #sentinel { height: 20px; }

        /* é³¥ç¨®ç¶²æ ¼æ¨£å¼ */
        .bird-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px; overflow-y: auto; flex: 1; }
        .bird-grid-item { 
            display: flex; flex-direction: column; align-items: center; text-align: center; 
            cursor: pointer; padding: 5px; border-radius: 6px; transition: 0.2s; border: 1px solid transparent; 
        }
        .bird-grid-item:hover { background: #f0f2f5; }
        .bird-grid-item.active { background: #e8f6fd; border-color: #3498db; }
        .bird-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background: #eee; margin-bottom: 5px; }
        .bird-name { font-size: 0.8rem; color: #333; line-height: 1.2; }

        /* RWD: æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar-right { display: none; /* æ‰‹æ©Ÿç‰ˆé è¨­éš±è—å³å´æœå°‹ */ }
            .sidebar-left { width: 100%; height: 60%; order: 2; border-right: none; border-top: 1px solid #ddd; }
            #map { height: 40%; order: 1; }
            
            /* æ‰‹æ©Ÿç‰ˆæµ®å‹•æŒ‰éˆ• */
            .mobile-float-btn {
                position: absolute; top: 10px; right: 10px; z-index: 100;
                background: white; padding: 8px 12px; border-radius: 20px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-weight: bold; font-size: 0.9rem;
                display: flex; align-items: center; gap: 5px;
            }
        }
        
        /* è³‡è¨Šé¢æ¿ (è©³æƒ…é ) */
        .detail-panel { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: white; z-index: 30; display: none; flex-direction: column; 
        }
        .detail-header { padding: 10px 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; }
        .back-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 5px; }
        .detail-content { flex: 1; overflow-y: auto; padding: 15px; }
        
        /* å¤©æ°£å°å¡ */
        .weather-widget { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); padding: 10px; border-radius: 8px; margin-bottom: 15px; color: #2c3e50; }
        
        /* è§€æ¸¬ç´€éŒ„æ¢ç›® */
        .obs-item { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .obs-img { width: 80px; height: 80px; border-radius: 6px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .obs-info { flex: 1; }
        .obs-time { font-size: 0.8rem; color: #888; margin-bottom: 4px; }
        .obs-bird { font-weight: bold; font-size: 1rem; color: #2c3e50; }
        .obs-desc { font-size: 0.85rem; color: #555; margin-top: 4px; line-height: 1.4; }

    </style>
</head>
<body>

<div class="container">
    <div id="map"></div>
    
    <div class="mobile-float-btn" onclick="toggleMobileSearch()" id="mobile-search-btn" style="display:none;">
        ğŸ” æ‰¾é³¥ç¨®
    </div>

    <div class="sidebar-left">
        <div class="header">ğŸ¦ å°ç£å¥½é³¥ç³»çµ±</div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('record')">è¿‘æœŸç´€éŒ„</div>
            <div class="tab" onclick="switchTab('hotspot')">è³é³¥ç†±é»</div>
        </div>
        
        <div id="location-list-container" class="list-container">
            </div>

        <div id="hotspot-list-container" class="list-container" style="display:none;">
            </div>
        
        <div id="location-detail-panel" class="detail-panel">
            <div class="detail-header">
                <button class="back-btn" onclick="closeDetail()">â¬…</button>
                <h3 id="detail-title" style="margin:0;">åœ°é»åç¨±</h3>
            </div>
            <div id="detail-body" class="detail-content"></div>
        </div>
    </div>

    <div class="sidebar-right" id="sidebar-right">
        <div style="padding:10px; border-bottom:1px solid #eee;">
            <input type="text" id="bird-search" placeholder="æœå°‹é³¥ç¨®åç¨±..." 
                   style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; box-sizing:border-box;"
                   oninput="searchBirdGrid(this.value)">
        </div>
        <div id="bird-grid-container" class="bird-grid">
            </div>
        <div id="sentinel"></div> </div>
</div>

<script>
    let map;
    let markers = [];
    let markerCluster;
    let allBirdsData = {}; // åŸå§‹ JSON è³‡æ–™
    let allRecentList = []; // â˜… æ–°å¢ï¼šæ‹å¹³å¾Œçš„è¿‘æœŸç´€éŒ„ç¸½è¡¨
    let allHotspotsList = []; // â˜… æ–°å¢ï¼šæ‹å¹³å¾Œçš„ç†±é»ç¸½è¡¨
    
    let currentTab = 'record';
    let currentFilterSpeciesCode = null;
    
    // åˆå§‹åŒ–åœ°åœ–
    async function initMap() {
        // é è¨­ä¸­å¿ƒï¼šå°ç£åœ°ç†ä¸­å¿ƒ
        const center = { lat: 23.9738, lng: 120.9820 };
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 8,
            center: center,
            mapTypeControl: false,
            streetViewControl: false,
            fullscreenControl: false,
            styles: [
                { featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }
            ]
        });

        // è¼‰å…¥è³‡æ–™
        await loadData();
        
        // æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•é¡¯ç¤ºé‚è¼¯
        if(window.innerWidth <= 768) {
            document.getElementById('mobile-search-btn').style.display = 'flex';
        }
    }

    // â˜… ä¿®æ­£ï¼šè³‡æ–™è¼‰å…¥èˆ‡çµæ§‹è½‰æ›
    async function loadData() {
        try {
            const response = await fetch('static/birds_data.json?v=' + new Date().getTime());
            allBirdsData = await response.json();
            
            // 1. è™•ç† Recent è³‡æ–™ (Flattening)
            // å…¼å®¹æ€§æª¢æŸ¥ï¼šå¦‚æœæ˜¯é™£åˆ—(èˆŠç‰ˆ)ç›´æ¥ç”¨ï¼Œå¦‚æœæ˜¯ç‰©ä»¶(æ–°ç‰ˆ update_data.py)å‰‡æ‹å¹³
            if (Array.isArray(allBirdsData.recent)) {
                allRecentList = allBirdsData.recent;
            } else {
                // å°‡å„ç¸£å¸‚çš„ Array åˆä½µæˆä¸€å€‹å¤§ Array
                allRecentList = Object.values(allBirdsData.recent).flat();
            }

            // 2. è™•ç† Hotspots è³‡æ–™ (Flattening)
            allHotspotsList = Object.values(allBirdsData.hotspots).flat();

            console.log(`âœ… è³‡æ–™è¼‰å…¥å®Œæˆï¼šè¿‘æœŸç´€éŒ„ ${allRecentList.length} ç­†ï¼Œç†±é» ${allHotspotsList.length} è™•`);

            // 3. åˆå§‹æ¸²æŸ“
            renderBirdGrid(allRecentList);     // å³å´é³¥ç¨®ç¶²æ ¼
            renderMarkers(allRecentList, false); // åœ°åœ–æ¨™è¨˜
            renderLocationList(allRecentList);   // å·¦å´åˆ—è¡¨

        } catch (error) {
            console.error("è³‡æ–™è¼‰å…¥å¤±æ•—:", error);
            alert("è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèª birds_data.json æ˜¯å¦å­˜åœ¨");
        }
    }

    // --- Tab åˆ‡æ› ---
    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
        
        document.getElementById('location-list-container').style.display = tab === 'record' ? 'block' : 'none';
        document.getElementById('hotspot-list-container').style.display = tab === 'hotspot' ? 'block' : 'none';
        
        // åˆ‡æ›è³‡æ–™æº
        if (tab === 'record') {
            renderMarkers(currentFilterSpeciesCode ? 
                allRecentList.filter(b => b.speciesCode === currentFilterSpeciesCode) : 
                allRecentList, false);
            // å¦‚æœæœ‰ç¯©é¸ï¼Œä¿æŒç¯©é¸ç‹€æ…‹çš„åˆ—è¡¨
            if (currentFilterSpeciesCode) {
                 const filtered = allRecentList.filter(b => b.speciesCode === currentFilterSpeciesCode);
                 renderLocationList(filtered);
            } else {
                 renderLocationList(allRecentList);
            }
        } else {
            // ç†±é»æ¨¡å¼ï¼šé¡¯ç¤ºæ‰€æœ‰ç†±é»
            renderMarkers(allHotspotsList, true); 
            renderHotspotList(allHotspotsList);
        }
        closeDetail();
    }

    // --- â˜… ä¿®æ­£ï¼šæ¸²æŸ“å·¦å´åœ°é»åˆ—è¡¨ (åŠ å…¥ç¾¤çµ„åŒ–çµ±è¨ˆ) ---
    function renderLocationList(data) {
        const container = document.getElementById('location-list-container');
        container.innerHTML = '';

        // 1. çµ±è¨ˆåœ°é»è³‡æ–™
        const locStats = {};
        data.forEach(obs => {
            // ä½¿ç”¨åœ°é»åç¨±ä½œç‚º Key
            if (!locStats[obs.locName]) {
                locStats[obs.locName] = {
                    count: 0,
                    lat: obs.lat,
                    lng: obs.lng,
                    county: obs.county || "å°ç£", // ä½¿ç”¨å¾Œç«¯æä¾›çš„ç¸£å¸‚å
                    obsList: [] // æš«å­˜è©²åœ°é»çš„é³¥è³‡æ–™ (å¯é¸)
                };
            }
            locStats[obs.locName].count++;
        });

        // 2. è½‰ç‚ºé™£åˆ—ä¸¦æ’åº (ç­†æ•¸å¤š -> å°‘)
        const sortedLocs = Object.entries(locStats).sort((a, b) => b[1].count - a[1].count);

        // 3. æ¸²æŸ“å¡ç‰‡
        if (sortedLocs.length === 0) {
            container.innerHTML = '<div style="padding:20px; text-align:center; color:#888;">æŸ¥ç„¡è³‡æ–™</div>';
            return;
        }

        sortedLocs.forEach(([name, info]) => {
            const div = document.createElement('div');
            div.className = 'loc-card';
            div.innerHTML = `
                <div class="loc-name">${name}</div>
                <div class="loc-meta">
                    <span class="county-tag">${info.county}</span>
                    <span class="count-badge">æ­¤åœ° ${info.count} ç­†ç´€éŒ„</span>
                </div>
            `;
            // é»æ“Šäº‹ä»¶ï¼šç§»è‡³åœ°åœ–ä¸¦æ‰“é–‹è©³æƒ…
            div.onclick = () => {
                map.setCenter({ lat: info.lat, lng: info.lng });
                map.setZoom(15);
                openLocationDetail(name, info.lat, info.lng);
                // æ‰‹æ©Ÿç‰ˆï¼šé»æ“Šå¾Œè‡ªå‹•æ”¶èµ·åœ°åœ– (å¦‚æœæ˜¯åœ¨å…¨è¢å¹•æ¨¡å¼) - é€™è£¡ç¶­æŒåŸæ¨£ï¼Œä¸åšé¡å¤–æ“ä½œ
            };
            container.appendChild(div);
        });
    }

    // æ¸²æŸ“ç†±é»åˆ—è¡¨
    function renderHotspotList(data) {
        const container = document.getElementById('hotspot-list-container');
        container.innerHTML = '';
        
        data.forEach(spot => {
            const div = document.createElement('div');
            div.className = 'loc-card';
            div.style.borderLeftColor = '#27ae60'; // ç†±é»ç”¨ç¶ è‰²
            div.innerHTML = `
                <div class="loc-name">ğŸŒŸ ${spot.name}</div>
                <div class="loc-meta">
                    <span>${spot.desc || 'çŸ¥åè³é³¥é»'}</span>
                </div>
            `;
            div.onclick = () => {
                map.setCenter({ lat: spot.lat, lng: spot.lng });
                map.setZoom(14);
                openHotspotDetail(spot);
            };
            container.appendChild(div);
        });
    }

    // --- â˜… ä¿®æ­£ï¼šé³¥ç¨®éæ¿¾é€£å‹• (é»æ“Šå³å´ç¶²æ ¼) ---
    function filterBirds(speciesCode) {
        currentFilterSpeciesCode = speciesCode;
        
        // 1. ç¯©é¸è³‡æ–™ (å¾æ‹å¹³å¾Œçš„åˆ—è¡¨æ‰¾)
        const filtered = allRecentList.filter(b => b.speciesCode === speciesCode);
        
        // 2. æ›´æ–°åœ°åœ–
        renderMarkers(filtered, false);
        
        // 3. â˜… æ›´æ–°å·¦å´åˆ—è¡¨ï¼šé¡¯ç¤ºè©²é³¥ç¨®å‡ºç¾çš„åœ°é»èˆ‡æ¬¡æ•¸
        // åˆ‡æ›å›ç´€éŒ„ Tab
        if (currentTab !== 'record') {
            switchTab('record');
        }
        renderLocationList(filtered);

        // 4. UI é«˜äº®æ›´æ–°
        document.querySelectorAll('.bird-grid-item').forEach(el => {
            if (el.dataset.code === speciesCode) el.classList.add('active');
            else el.classList.remove('active');
        });
        
        // æ‰‹æ©Ÿç‰ˆï¼šé»é¸å¾Œé—œé–‰æœå°‹é¢æ¿
        if (window.innerWidth <= 768) {
            document.getElementById('sidebar-right').style.display = 'none';
        }
    }

    // --- æ¸²æŸ“å³å´é³¥ç¨®ç¶²æ ¼ ---
    function renderBirdGrid(data) {
        const container = document.getElementById('bird-grid-container');
        const uniqueBirds = {};
        
        // å»é‡ï¼šåŒç¨®é³¥åªé¡¯ç¤ºä¸€æ¬¡
        data.forEach(b => {
            if (!uniqueBirds[b.speciesCode]) {
                uniqueBirds[b.speciesCode] = {
                    name: b.name,
                    code: b.speciesCode,
                    img: b.wikiImg || 'https://via.placeholder.com/60?text=Bird'
                };
            }
        });

        const sortedBirds = Object.values(uniqueBirds); // é€™è£¡å¯ä»¥åŠ å…¥æ’åºé‚è¼¯
        
        let html = '';
        // åŠ ä¸Šã€Œé¡¯ç¤ºå…¨éƒ¨ã€æŒ‰éˆ•
        html += `
            <div class="bird-grid-item" onclick="resetFilter()">
                <div class="bird-img" style="display:flex;align-items:center;justify-content:center;background:#ddd;">â™¾ï¸</div>
                <div class="bird-name">é¡¯ç¤ºå…¨éƒ¨</div>
            </div>
        `;

        sortedBirds.forEach(b => {
            html += `
                <div class="bird-grid-item" data-code="${b.code}" onclick="filterBirds('${b.code}')">
                    <img src="${b.img}" class="bird-img" loading="lazy" onerror="this.src='https://via.placeholder.com/60?text=Bird'">
                    <div class="bird-name">${b.name}</div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }

    function resetFilter() {
        currentFilterSpeciesCode = null;
        renderMarkers(allRecentList, false);
        renderLocationList(allRecentList);
        document.querySelectorAll('.bird-grid-item').forEach(el => el.classList.remove('active'));
    }

    // --- åœ°åœ– Marker é‚è¼¯ ---
    function renderMarkers(data, isHotspotMode) {
        // æ¸…é™¤èˆŠ Marker
        if (markerCluster) markerCluster.clearMarkers();
        markers = [];

        markers = data.map(item => {
            const marker = new google.maps.Marker({
                position: { lat: parseFloat(item.lat), lng: parseFloat(item.lng) },
                title: item.name,
                // å¦‚æœæ˜¯ç†±é»æ¨¡å¼ç”¨ç¶ è‰²ï¼Œå¦å‰‡é è¨­ç´…è‰²
                icon: isHotspotMode ? 'http://maps.google.com/mapfiles/ms/icons/green-dot.png' : null 
            });

            marker.addListener("click", () => {
                if (isHotspotMode) openHotspotDetail(item);
                else openLocationDetail(item.locName, item.lat, item.lng);
            });
            return marker;
        });

        markerCluster = new markerClusterer.MarkerClusterer({ map, markers });
    }

    // --- è©³æƒ…é é‚è¼¯ (åŒ…å«å¤©æ°£èˆ‡ç¶­åŸºç™¾ç§‘) ---
    async function openLocationDetail(locName, lat, lng) {
        const panel = document.getElementById('location-detail-panel');
        const title = document.getElementById('detail-title');
        const body = document.getElementById('detail-body');
        
        panel.style.display = 'flex';
        title.innerText = locName;
        body.innerHTML = '<div style="text-align:center;padding:20px;">è¼‰å…¥ä¸­...</div>';

        // 1. å–å¾—å¤©æ°£ (Open-Meteo)
        let weatherHtml = '';
        try {
            const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&hourly=temperature_2m,weathercode&timezone=auto&forecast_days=1`);
            const wData = await wRes.json();
            const now = new Date().getHours();
            const temp = wData.hourly.temperature_2m[now];
            const wCode = wData.hourly.weathercode[now];
            // ç°¡å–®çš„å¤©æ°£ä»£ç¢¼è½‰æ›
            const wDesc = wCode > 60 ? 'ğŸŒ§ï¸ æœ‰é›¨' : (wCode > 3 ? 'â˜ï¸ å¤šé›²' : 'â˜€ï¸ æ™´æœ—');
            
            weatherHtml = `
                <div class="weather-widget">
                    <h4>ğŸŒ¤ï¸ ç•¶åœ°å¤©æ°£æ¦‚æ³</h4>
                    <div style="font-size:1.5rem; font-weight:bold;">${temp}Â°C ${wDesc}</div>
                    <div style="font-size:0.9rem; margin-top:5px;">é©å®œè³é³¥æŒ‡æ•¸ï¼š${wCode > 60 ? 'â­â­ (æœ‰é›¨)' : 'â­â­â­â­'}</div>
                </div>
            `;
        } catch(e) { console.warn("å¤©æ°£è¼‰å…¥å¤±æ•—"); }

        // 2. ç¯©é¸æ­¤åœ°é»çš„é³¥é¡ç´€éŒ„
        const locBirds = allRecentList.filter(b => b.locName === locName);
        
        let birdsHtml = '<h4>ğŸ‘€ è¿‘æœŸè§€æ¸¬ç´€éŒ„</h4>';
        locBirds.forEach(b => {
            const timeStr = b.date ? b.date.substring(5, 16) : 'æœªçŸ¥æ™‚é–“';
            birdsHtml += `
                <div class="obs-item">
                    <img src="${b.wikiImg || 'https://via.placeholder.com/80'}" class="obs-img" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="obs-info">
                        <div class="obs-bird">${b.name}</div>
                        <div class="obs-time">ğŸ•’ ${timeStr}</div>
                        <div class="obs-desc">${b.wikiDesc ? b.wikiDesc.substring(0, 60)+'...' : 'æš«ç„¡ç°¡ä»‹'}</div>
                    </div>
                </div>
            `;
        });

        body.innerHTML = weatherHtml + birdsHtml;
    }

    function openHotspotDetail(spot) {
        const panel = document.getElementById('location-detail-panel');
        document.getElementById('detail-title').innerText = spot.name;
        const body = document.getElementById('detail-body');
        panel.style.display = 'flex';
        
        let html = `<div style="padding:10px; color:#555;">${spot.desc}</div>`;
        html += '<h4>ğŸŒŸ ä»£è¡¨æ€§ / å¸¸é§é³¥ç¨®</h4>';
        
        if (spot.potential && spot.potential.length > 0) {
            spot.potential.forEach(b => {
                 html += `
                    <div class="obs-item">
                        <img src="${b.wikiImg || 'https://via.placeholder.com/80'}" class="obs-img">
                        <div class="obs-info">
                            <div class="obs-bird">${b.name}</div>
                            <div class="obs-desc">${b.wikiDesc || 'æš«ç„¡ç°¡ä»‹'}</div>
                        </div>
                    </div>
                `;
            });
        } else {
            html += '<p>å°šç„¡è©³ç´°è³‡æ–™</p>';
        }
        body.innerHTML = html;
    }

    function closeDetail() {
        document.getElementById('location-detail-panel').style.display = 'none';
    }
    
    // RWD æ‰‹æ©Ÿç‰ˆé³¥ç¨®æœå°‹é–‹é—œ
    function toggleMobileSearch() {
        const sidebar = document.getElementById('sidebar-right');
        if (sidebar.style.display === 'flex') {
            sidebar.style.display = 'none';
        } else {
            sidebar.style.display = 'flex';
            sidebar.style.position = 'absolute';
            sidebar.style.top = '0';
            sidebar.style.right = '0';
            sidebar.style.width = '80%';
            sidebar.style.height = '100%';
            sidebar.style.boxShadow = '-2px 0 10px rgba(0,0,0,0.2)';
        }
    }

    // é³¥ç¨®ç¶²æ ¼éæ¿¾ (è¼¸å…¥æ¡†)
    function searchBirdGrid(keyword) {
        const items = document.querySelectorAll('.bird-grid-item');
        items.forEach(item => {
            const name = item.querySelector('.bird-name').innerText;
            if (name.includes(keyword) || keyword === '') {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Google Maps API Callback
    function initApp() {
        // è¼‰å…¥ Google Maps Script (è«‹å‹™å¿…æ›¿æ› YOUR_API_KEY)
        // ç”±æ–¼é€™æ˜¯ç´”å‰ç«¯æ¼”ç¤ºï¼Œé€šå¸¸æœƒåœ¨ HTML head ä¸­ç›´æ¥å¼•å…¥ script
        // é€™è£¡å‡è¨­å¤–éƒ¨å·²ç¶“æœ‰ script src="...&callback=initMap"
        if(typeof google === 'undefined') {
            // å¦‚æœæ²’æœ‰ API Keyï¼Œé€™è£¡åªæ˜¯é˜²æ­¢å ±éŒ¯çš„å‡åˆå§‹åŒ–
            alert("è«‹åœ¨ HTML ä¸­å¡«å…¥æ­£ç¢ºçš„ Google Maps API Key æ‰èƒ½é¡¯ç¤ºåœ°åœ–");
        } else {
            initMap();
        }
    }

    // å•Ÿå‹• (ä½¿ç”¨ window.onload ç¢ºä¿è³‡æºè¼‰å…¥)
    window.onload = function() {
        // å¦‚æœ HTML head å·²ç¶“æœ‰ callback=initMapï¼Œé€™è¡Œå…¶å¯¦æ˜¯å¤šé¤˜çš„ï¼Œä½†ç‚ºäº†ä¿éšªèµ·è¦‹
        if(typeof google !== 'undefined') initMap(); 
    };

</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>

</body>
</html>
